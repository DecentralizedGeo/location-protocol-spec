{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/DecentralizedGeo/location-protocol-spec/refs/heads/main/json-schema/schema.json",
  "title": "Location Protocol Payload",
  "description": "A complete schema for a Location Protocol record payload.",
  "type": "object",
  "properties": {
    "lp_version": {
      "$ref": "#/definitions/lp_version"
    },
    "srs": {
      "$ref": "#/definitions/srs"
    },
    "location_type": {
      "$ref": "#/definitions/location_type"
    },
    "location": {
      "description": "The location data, whose format is determined by location_type.",
      "oneOf": [
        { "$ref": "#/definitions/locationCoordinateDecimal" },
        { "$ref": "#/definitions/locationGeoJSON" },
        { "$ref": "#/definitions/locationH3" },
        { "$ref": "#/definitions/locationGeohash" },
        { "$ref": "#/definitions/locationWKT" },
        { "$ref": "#/definitions/locationAddress" },
        { "$ref": "#/definitions/locationScaledCoordinates" }
      ]
    },
    "event_timestamp": {
      "$ref": "#/definitions/event_timestamp"
    },
    "media_data": {
      "$ref": "#/definitions/media_data"
    },
    "media_type": {
      "$ref": "#/definitions/media_type"
    },
    "attributes": {
      "$ref": "#/definitions/attributes"
    },
    "attributes_schema": {
      "$ref": "#/definitions/attributes_schema"
    },
    "proof": {
      "$ref": "#/definitions/proof"
    },
    "extensions": {
      "type": "object",
      "description": "An object for custom, non-standard fields."
    }
  },
  "required": ["lp_version", "srs", "location_type", "location"],
  "oneOf": [
    {
      "properties": {
        "location_type": { "const": "coordinate-decimal+lon-lat" },
        "location": { "$ref": "#/definitions/locationCoordinateDecimal" }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "geojson-point" },
        "location": { "allOf": [ { "$ref": "#/definitions/locationGeoJSON" }, { "properties": { "type": { "const": "Point" } }, "required": ["type"] } ] }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "geojson-line" },
        "location": { "allOf": [ { "$ref": "#/definitions/locationGeoJSON" }, { "properties": { "type": { "const": "LineString" } }, "required": ["type"] } ] }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "geojson-polygon" },
        "location": { "allOf": [ { "$ref": "#/definitions/locationGeoJSON" }, { "properties": { "type": { "const": "Polygon" } }, "required": ["type"] } ] }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "h3" },
        "location": { "$ref": "#/definitions/locationH3" }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "geohash" },
        "location": { "$ref": "#/definitions/locationGeohash" }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "wkt" },
        "location": { "$ref": "#/definitions/locationWKT" }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "address" },
        "location": { "$ref": "#/definitions/locationAddress" }
      },
      "required": ["location_type", "location"]
    },
    {
      "properties": {
        "location_type": { "const": "scaledCoordinates" },
        "location": { "$ref": "#/definitions/locationScaledCoordinates" }
      },
      "required": ["location_type", "location"]
    }
  ],
  "definitions": {
    "lp_version": {
      "type": "string",
      "description": "The version of the Location Protocol specification.",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },
    "srs": {
      "type": "string",
      "description": "The Spatial Reference System URI, following OGC standards.",
      "format": "uri",
      "examples": [
        "http://www.opengis.net/def/crs/OGC/1.3/CRS84",
        "http://www.opengis.net/def/crs/EPSG/0/4326"
      ]
    },
    "location_type": {
      "type": "string",
      "description": "Identifier for the location data format.",
      "enum": ["coordinate-decimal+lon-lat", "geojson-point", "geojson-line", "geojson-polygon", "h3", "geohash", "wkt", "address", "scaledCoordinates"]
    },
    "locationCoordinateDecimal": {
      "description": "Location as a longitude, latitude array.",
      "type": "array",
      "items": { "type": "number" },
      "minItems": 2,
      "maxItems": 2
    },
    "locationGeoJSON": {
      "description": "A GeoJSON Geometry object as defined in RFC 7946. Supports geometry types: Point, LineString, and Polygon.",
      "type": "object",
      "properties": {
        "type": {
          "enum": ["Point", "LineString", "Polygon"]
        }
      },
      "required": ["type"],
      "additionalProperties": true
    },
    "locationH3": {
      "description": "Location as an H3 cell index.",
      "type": "string",
      "pattern": "^[89ab][0-9a-f]{14}$"
    },
    "locationGeohash": {
      "description": "Location as a Geohash string.",
      "type": "string",
      "pattern": "^[0123456789bcdefghjkmnpqrstuvwxyz]+$"
    },
    "locationWKT": {
      "description": "Location as a Well-Known Text (WKT) string.",
      "type": "string"
    },
    "locationAddress": {
      "description": "Location as a standard mailing or street address.",
      "type": "string"
    },
    "locationScaledCoordinates": {
      "description": "Location as scaled integer coordinates.",
      "type": "object",
      "properties": {
        "x": { "type": "integer" },
        "y": { "type": "integer" },
        "scale": { "type": "integer", "exclusiveMinimum": 0 }
      },
      "required": ["x", "y", "scale"]
    },
    "event_timestamp": {
      "type": "integer",
      "description": "Unix timestamp (seconds since epoch) of the event.",
      "exclusiveMinimum": 0
    },
    "media_data": {
      "type": "string",
      "description": "A URI or Content Identifier (CID) for associated media."
    },
    "media_type": {
      "type": "string",
      "description": "The MIME type of the associated media_data.",
      "examples": ["image/jpeg", "video/mp4"]
    },
    "attributes": {
      "type": "string",
      "description": "JSON-encoded structured metadata or CID reference."
    },
    "attributes_schema": {
      "type": "string",
      "description": "Schema reference using prefix notation (e.g., 'json:inline:', 'ipfs:cid:', 'eas:chain:', 'atproto:lexicon:')."
    },
    "proof": {
      "type": "object",
      "description": "A cryptographic proof of the location claim.",
      "properties": {
        "stamp_types": {
          "type": "string",
          "description": "Identifier for the proof generation method."
        },
        "stamps": {
          "type": "string",
          "description": "The data required to verify the proof."
        }
      },
      "required": ["stamp_types", "stamps"]
    }
  }
}